<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>الواجهة الأساسية المُحسّنة والسريعة - نُسخة VIP</title>
<style>
body, html {
    margin: 0; padding: 0; width: 100%; height: 100%;
    background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    color: white; overflow: hidden; touch-action: pan-y;
}

@keyframes neonGlow {
    0%, 100% { box-shadow: 0 0 8px #00aaff, 0 0 16px #00aaff, inset 0 0 4px #00aaff; }
    50% { box-shadow: 0 0 12px #ff00aa, 0 0 24px #ff00aa, inset 0 0 6px #ff00aa; }
}
@keyframes  VIPGlow {
    0%, 100% { border-color: #ffd700; box-shadow: 0 0 10px #ffd700, 0 0 20px rgba(255, 215, 0, 0.4); }
    50% { border-color: #ff4500; box-shadow: 0 0 15px #ff4500, 0 0 30px rgba(255, 69, 0, 0.6); }
}
@keyframes twinkle { 0%, 100% { opacity: 0.7; } 50% { opacity: 0.9; } }
@keyframes fall { to { transform: translateY(100vh); } }

.stars {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0;
    background-image: radial-gradient(white, rgba(255,255,255,.7) 1px, transparent 2px), radial-gradient(white, rgba(255,255,255,.5) 1px, transparent 2px);
    background-size: 50px 50px, 70px 70px;
    background-position: 0 0, 25px 25px;
    opacity: 0.8; animation: twinkle 4s infinite ease-in-out;
}
.rain {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; overflow: hidden;
}
.drop {
    position: absolute; width: 2px; height: 15px; background: rgba(255, 255, 255, 0.4); border-radius: 0 0 2px 2px;
    animation: fall linear infinite;
}

.container {
    display: flex; flex-direction: column; align-items: center; justify-content: flex-start;
    padding: 150px 12px 60px; box-sizing: border-box; height: 100vh; width: 100%; 
    overflow-y: auto; overflow-x: hidden; position: relative; z-index: 10;
    -webkit-overflow-scrolling: touch;
}

.VIP-banner-strip {
    position: fixed; top: 0; left: 0; right: 0; width: 100%; max-width: 404px; margin: 0 auto;
    height: 60px; overflow: hidden; z-index: 51;
    background: rgba(15, 12, 41, 0.9); box-shadow: 0 5px 10px rgba(0, 0, 0, 0.5);
    transition: opacity 0.3s;
}
.VIP-banner-inner { display: flex; height: 100%; transition: transform 0.5s ease-in-out; }
.VIP-banner {
    min-width: 100%; display: flex; align-items: center; justify-content: center;
    padding: 0 10px; box-sizing: border-box; text-align: center; cursor: pointer;
}
.VIP-banner-text {
    font-size: 14px; font-weight: bold; color: #ffd700; 
    text-shadow: 0 0 5px rgba(255, 215, 0, 0.8); letter-spacing: 0.5px;
    display: flex; align-items: center; gap: 8px; padding: 5px 10px; border-radius: 8px;
    background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 215, 0, 0.3);
    transition: transform 0.15s;
}
.VIP-banner:active .VIP-banner-text { transform: scale(0.98); }
.VIP-icon-star { font-size: 18px; color: #ff4500; animation: GlowVIP 3s infinite alternate ease-in-out; }

.search-wrapper {
    position: fixed; top: 60px; left: 0; right: 0; width: 100%; max-width: 404px; margin: 0 auto;
    display: flex; justify-content: center; padding: 10px 12px 15px; box-sizing: border-box;
    z-index: 50; background: linear-gradient(135deg, #0f0c29 5%, #302b63 100%); 
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
}
.search-wrapper-inner { width: 100%; max-width: 380px; display: flex; align-items: center; }

@keyframes controlPulse {
    0%, 100% { color: #ffeb3b; text-shadow: 0 0 5px #ffeb3b, 0 0 10px rgba(255, 235, 59, 0.6); transform: scale(1); }
    50% { color: #fff; text-shadow: 0 0 8px #fff, 0 0 16px #ff0055; transform: scale(1.1); }
}
#sidebar-btn {
    background: none; border: none; font-size: 28px; cursor: pointer;
    padding: 0 10px; transition: color 0.15s, transform 0.15s; order: 1;
    color: #ffeb3b; animation: controlPulse 3s infinite alternate ease-in-out;
    position: relative; overflow: hidden; line-height: 1; 
}
#sidebar-btn:hover { transform: scale(1.05); }

#searchInput {
    width: 100%; max-width: 380px; padding: 12px 20px; border: 2px solid #302b63;
    border-radius: 25px; background-color: rgba(255, 255, 255, 0.15); color: white;
    font-size: 16px; box-shadow: 0 0 8px rgba(0, 200, 255, 0.3);
    transition: border-color 0.1s, background-color 0.1s, box-shadow 0.1s; 
    text-align: right; direction: rtl; order: 2; 
}
#searchInput::placeholder { color: rgba(255, 255, 255, 0.7); }
#searchInput:focus { 
    border-color: #00aaff; background-color: rgba(255, 255, 255, 0.25); 
    outline: none; box-shadow: 0 0 12px rgba(0, 200, 255, 0.6); 
}

.icon-grid {
    display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; 
    width: 100%; max-width: 380px; padding: 0 8px; margin-top: 10px;
}
.icon-item {
    display: flex; flex-direction: column; align-items: center; gap: 6px; 
    width: 100%; text-align: center; cursor: pointer; 
    transition: opacity 0.15s ease-out, transform 0.15s ease-out;
}
@keyframes bounceIn { 0% { transform: scale(0.9); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
.icon-item:not(.hidden) { animation: bounceIn 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
.icon-item.hidden { display: none; opacity: 0; transform: scale(0.9); }

.fixed-logo {
    display: block; width: 84px; height: 84px; object-fit: cover; border-radius: 12px;
    box-shadow: 0 0 3px rgba(0, 0, 0, 0.5); background: rgba(255, 255, 255, 0.14); 
    padding: 3px; position: relative; overflow: hidden; 
    transition: transform 0.15s, box-shadow 0.15s; transform: translateZ(0); 
    -webkit-tap-highlight-color: transparent; 
}
.fixed-logo:active { transform: scale(0.95); box-shadow: 0 0 12px #ffeb3b, 0 0 24px #ff00aa; }
.fixed-logo:hover { transform: scale(1.05); box-shadow: 0 0 10px #00aaff, 0 0 20px #00aaff, 0 0 6px #ff00aa; }
.fixed-logo.neon-active { animation: neonGlow 3s infinite alternate ease-in-out; }
.fixed-logo.VIP-active { border: 3px solid #ffd700; animation: GlowVIP 3s infinite alternate ease-in-out; }

.VIP-logo {
    background: linear-gradient(45deg, #ffd700, #ff4500); border: 3px solid #ff4500;
    box-shadow: 0 0 15px #ffd700, 0 0 30px rgba(255, 69, 0, 0.6);
    animation: GlowVIP 3s infinite alternate ease-in-out; padding: 0;
    display: flex; align-items: center; justify-content: center;
    font-size: 32px; color: #0f0c29; font-weight: 900; border-radius: 12px;
}
.VIP-logo:hover { transform: scale(1.05); box-shadow: 0 0 20px #ffd700, 0 0 40px #ff4500; }

.icon-label {
    color: white; font-size: 12px; text-align: center; line-height: 1.35;
    text-shadow: 0 1px 2px rgba(0,0,0,0.75); width: 100%; white-space: normal;
    word-break: break-word; min-height: 32px; display: flex; 
    align-items: center; justify-content: center; flex-direction: column; 
}
.icon-label-VIP { color: #ffd700; text-shadow: 0 0 5px #ff4500; }
.icon-label-VIP .user-count { display: none; }
.icon-label.VIP-active-label { color: #ffd700; text-shadow: 0 0 5px #ff4500; }

.user-count {
    font-size: 10px; font-family: 'Share Tech Mono', monospace; color: #00ffaa;
    text-shadow: 0 0 5px rgba(0, 255, 170, 0.6); margin-top: 2px;
    display: flex; align-items: center; gap: 3px; transition: color 0.3s;
}
.user-count::before { content: "اللاعبين:"; color: rgba(255, 255, 255, 0.7); font-size: 9px; margin-right: 2px; }
.user-count.high-activity { color: #ffcc00; text-shadow: 0 0 5px #ffcc00, 0 0 10px rgba(255, 204, 0, 0.5); }
.user-count svg { width: 10px; height: 10px; fill: currentColor; }
.user-count-number { transition: transform 0.1s; }
.user-count-number.pulse { animation: pulse 0.3s ease-out; }
@keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.2); } 100% { transform: scale(1); } }

@keyframes sidebarGlow {
    0% { background-position: 0% 50%; box-shadow: 5px 0 15px rgba(0, 0, 0, 0.7); border-left: 2px solid #ff0055; }
    50% { background-position: 100% 50%; box-shadow: 5px 0 25px rgba(0, 0, 0, 0.9), 0 0 15px #00aaff; border-left: 2px solid #00aaff; }
    100% { background-position: 0% 50%; box-shadow: 5px 0 15px rgba(0, 0, 0, 0.7); border-left: 2px solid #ff0055; }
}

.sidebar {
    height: 100%; width: 70%; max-width: 320px; position: fixed; z-index: 100; top: 0; right: 100%;
    background: rgba(15, 12, 41, 0.95); box-shadow: 5px 0 15px rgba(0, 0, 0, 0.7); 
    padding: 20px; box-sizing: border-box; 
    transition: transform 0.3s ease-out, box-shadow 0.3s; direction: rtl; overflow-y: auto;
    border-radius: 0 10px 10px 0; 
    background-image: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
    background-size: 200% 200%;
}
.sidebar.effect-active { animation: sidebarGlow 6s infinite alternate; }
.sidebar.open { transform: translateX(100%); }
.sidebar h2 {
    color: #00aaff; text-align: center; margin-top: 0; padding-bottom: 10px;
    border-bottom: 1px solid rgba(0, 170, 255, 0.3); 
    text-shadow: 0 0 8px rgba(0, 170, 255, 0.5); font-size: 18px;
}
.sidebar-control-item {
    display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;
    padding: 10px 0; border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}
.sidebar-control-item:last-child { border-bottom: none; }
.control-info { flex-grow: 1; padding-right: 10px; }
.control-info p { margin: 0; font-size: 14px; color: #e0f7ff; text-shadow: 0 0 1px rgba(0,0,0,0.5); }
.control-info small {
    display: block; font-size: 10px; color: rgba(255, 255, 255, 0.6); margin-top: 3px;
    font-family: 'Share Tech Mono', monospace;
}
.control-info.VIP p { color: #ffd700; text-shadow: 0 0 5px #ff4500; }

.toggle-switch { position: relative; display: inline-block; width: 45px; height: 25px; direction: ltr; }
.toggle-switch input { opacity: 0; width: 0; height: 0; }
.slider {
    position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0;
    background-color: #302b63; transition: 0.4s; border-radius: 25px;
    box-shadow: 0 0 5px rgba(0, 0, 0, 0.5), inset 0 0 2px rgba(255, 255, 255, 0.2);
}
.slider:before {
    position: absolute; content: ""; height: 19px; width: 19px; right: 3px; bottom: 3px; 
    background-color: #ccc; transition: 0.4s; border-radius: 50%;
    box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
}
input:checked + .slider {
    background-color: #00aaff;
    box-shadow: 0 0 5px #00aaff, inset 0 0 2px rgba(0, 170, 255, 0.8);
}
input:checked + .slider:before {
    transform: translateX(-20px); background-color: #fff;
    box-shadow: 0 0 8px rgba(255, 255, 255, 0.8);
}

.close-btn {
    position: absolute; top: 10px; left: 10px; font-size: 24px; color: #ff00aa;
    cursor: pointer; background: none; border: none; padding: 5px;
    text-shadow: 0 0 5px #ff00aa; transition: transform 0.15s;
}
.close-btn:hover { transform: scale(1.2); }

@keyframes toastGlow {
    0%, 100% { box-shadow: 0 4px 15px rgba(0, 0, 0, 0.7), 0 0 15px rgba(0, 170, 255, 0.3); }
    50% { box-shadow: 0 4px 15px rgba(0, 0, 0, 0.7), 0 0 18px rgba(255, 0, 85, 0.5); }
}
.toast-container {
    position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
    z-index: 1000; pointer-events: none; width: 90%; max-width: 340px; 
    display: flex; flex-direction: column-reverse; 
}
.toast {
    background-color: rgba(15, 12, 41, 0.95); color: #e0f7ff; 
    padding: 12px 18px; border-radius: 12px; margin-bottom: 10px; 
    animation: toastGlow 3s infinite alternate; opacity: 0;
    transition: opacity 0.3s ease-out, transform 0.3s ease-out;
    transform: translateY(20px); font-size: 15px; font-weight: bold; 
    text-align: center; white-space: normal; border-left: 4px solid #ff0055; 
    backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px);
}
.toast.show { opacity: 1; transform: translateY(0); }
.toast.VIP-success {
    border-left: 4px solid #ffd700; animation: GlowVIP 3s infinite alternate; color: #ffd700;
}
.toast.VIP-error { border-left: 4px solid #ff4500; color: #ff4500; }

#loadingScreen {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(10, 10, 30, 0.95); display: flex; justify-content: center;
    align-items: center; z-index: 9999; color: white; font-size: 20px;
    font-family: 'Segoe UI', sans-serif; flex-direction: column;
    opacity: 0; transition: opacity 0.15s ease-out;
}
#loadingText {
    margin-bottom: 20px; font-weight: bold; color: #00aaff; 
    text-shadow: 0 0 5px #00aaff, 0 0 10px rgba(0, 170, 255, 0.7);
}
#loadingSpinner {
    width: 40px; height: 40px; border: 4px solid rgba(255,255,255,0.3); 
    border-top: 4px solid #ff00aa; border-radius: 50%; 
    animation: spin 0.8s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }

.liquid-bg {
    position: fixed; top: -50%; left: -50%; width: 200%; height: 200%; z-index: -4;
    background: radial-gradient(circle at 30% 30%, rgba(255,0,85,0.12) 0%, transparent 40%),
                radial-gradient(circle at 70% 70%, rgba(0,200,255,0.1) 0%, transparent 45%);
    animation: liquidMove1 20s infinite linear, liquidMove2 35s infinite reverse linear; 
}
@keyframes liquidMove1 { 0% { transform: translate(0, 0) rotate(0deg); } 100% { transform: translate(-25%, -25%) rotate(360deg); } }
@keyframes liquidMove2 { 0% { transform: translate(25%, 25%) rotate(0deg); } 100% { transform: translate(0, 0) rotate(-360deg); } }

.image-container {
    position: fixed; left: 0; right: 0; 
    top: calc(env(safe-area-inset-top, 0px) + 2cm); bottom: 4cm;
    width: 100%; display: flex; flex-direction: column; align-items: center; 
    overflow: hidden; z-index: 1000;
}
.image-wrapper { position: relative; width: fit-content; z-index: 1; overflow: visible; }

@keyframes jitter { 
    0%, 100% { transform: translate(0, 0); } 
    25% { transform: translate(0.5px, -0.5px); } 
    75% { transform: translate(-0.5px, 0.5px); } 
}
@keyframes breathe { 
    0%, 100% { transform: scale(1) rotate(0deg); } 
    50% { transform: scale(1.01) rotate(0.15deg); } 
}

.image-wrapper img {
    max-width: 100%; max-height: calc(100% - 40px); object-fit: contain; display: block;
    pointer-events: none; user-select: none; -webkit-user-drag: none; 
    border: 6px solid white; position: relative; z-index: 1;
    clip-path: polygon(0% 5%, 5% 0%, 95% 0%, 100% 5%, 100% 95%, 95% 100%, 5% 100%, 0% 95%);
    animation: breathe 5s ease-in-out infinite;
    box-shadow: 0 0 15px rgba(255, 0, 85, 0.4), 0 0 30px rgba(0, 200, 255, 0.3);
    transform: translateZ(0);
}
.image-wrapper.jitter-active img { animation: breathe 5s ease-in-out infinite, jitter 0.08s infinite alternate !important; }
.image-wrapper.VIP-active-page img {
    border: 6px solid #ffd700;
    box-shadow: 0 0 20px #ffd700, 0 0 40px rgba(255, 69, 0, 0.8);
}

@keyframes fallLimited {
    0% { top: -80px; opacity: 0; transform: scale(0.8) translateZ(0); } 
    10% { opacity: 1; }
    90% { top: calc(100% + 60px); opacity: 1; } 
    100% { top: calc(100% + 60px); opacity: 0; transform: scale(1.1) translateZ(0); }
}
.falling-emoji {
    position: absolute; font-size: 28px; opacity: 0; pointer-events: none; z-index: 2;
    text-shadow: 0 0 8px white, 0 0 16px cyan; animation: fallLimited 5s linear infinite; 
}
.emoji-right { right: 2%; }
.emoji-left { left: 2%; }

@keyframes emojiPop { 
    0% { transform: scale(0.8) rotate(5deg); } 
    50% { transform: scale(1.1) rotate(-3deg); } 
    100% { transform: scale(1) rotate(0deg); } 
}
.emoji {
    position: absolute; font-size: 32px; z-index: 10; color: #ff0055;
    text-shadow: 0 0 10px #ff0055, 0 0 20px #ff00aa; opacity: 0;
    transition: opacity 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275), 
                transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    transform: scale(0.6) rotate(-10deg) translateZ(0);
}
.emoji.show {
    opacity: 1 !important; transform: scale(1) rotate(0deg) translateZ(0) !important; 
    animation: emojiPop 0.2s ease-out;
}
.emoji.VIP-emoji { color: #ffd700; text-shadow: 0 0 10px #ffd700, 0 0 20px #ff4500; }

.rare-indicator {
    position: absolute; font-size: 10px; font-weight: bold; color: #00ffaa;
    background: linear-gradient(135deg, rgba(0, 170, 255, 0.8), rgba(255, 0, 85, 0.8));
    padding: 3px 6px; border-radius: 6px; white-space: nowrap; 
    text-shadow: 0 0 5px #00ffaa, 0 0 10px #00aaff; opacity: 0; z-index: 11; 
    pointer-events: none; border: 1px solid #00aaff;
    font-family: 'Share Tech Mono', monospace; 
    transition: opacity 0.05s step-end, transform 0.05s step-end;
}
.rare-indicator.VIP-indicator {
    color: #0f0c29; background: linear-gradient(135deg, #ffd700, #ff4500);
    border: 1px solid #ffd700; text-shadow: none; font-size: 11px; font-weight: 900;
}

@keyframes flashIn { 0% { opacity: 0; transform: scale(0.5); } 100% { opacity: 1; transform: scale(1); } }
@keyframes indicatorPulse {
    0%, 100% { transform: translateY(0) scale(1.0); opacity: 0.9; } 
    50% { transform: translateY(-2px) scale(1.03); opacity: 1; }
}
.rare-indicator.active {
    opacity: 1; 
    animation: flashIn 0.15s cubic-bezier(0.175, 0.885, 0.32, 1.275), 
               indicatorPulse 1s infinite ease-in-out;
}

@keyframes captionFloat { 0% { transform: translateX(-3px); } 100% { transform: translateX(3px); } }
@keyframes slide { from { transform: translateX(0); } to { transform: translateX(-50%); } }
@keyframes textGlow { 
    0%, 100% { text-shadow: 0 0 5px rgba(0, 0, 0, 0.3); } 
    50% { text-shadow: 0 0 10px rgba(0, 191, 255, 0.6), 0 0 15px rgba(0, 200, 255, 0.4); } 
}
@keyframes CaptionGlowVIP { 
    0%, 100% { text-shadow: 0 0 5px #ffd700, 0 0 10px #ff4500; } 
    50% { text-shadow: 0 0 8px #ff4500, 0 0 16px #ffd700; } 
}

.caption {
    width: 100%; text-align: center; background: #0f0f15; color: #e0f7ff;
    font-size: 1.2rem; font-weight: bold; line-height: 34px; height: 34px;
    z-index: 3; position: relative; letter-spacing: 1px;
    border: 1px solid rgba(0, 200, 255, 0.3); box-shadow: 0 0 8px rgba(0, 191, 255, 0.2);
    animation: textGlow 3s ease-in-out infinite, captionFloat 6s infinite alternate;
}
.caption.project-1-8::before, .caption.project-1-8::after {
    content: ""; position: absolute; left: 0; width: 200%; height: 8px;
    background: repeating-linear-gradient(90deg, #ff0055 0px, #ff6600 20px, #ffff00 40px, #00ff44 60px, #00aaff 80px, #6600ff 100px, #cc00ff 120px);
    animation: slide 1s linear infinite;
}
.caption.project-1-8::before { top: -8px; }
.caption.project-1-8::after { bottom: -8px; animation-direction: reverse; }

.caption.VIP-caption {
    color: #ffd700; border: 1px solid #ff4500; box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
    animation: CaptionGlowVIP 3s ease-in-out infinite, captionFloat 6s infinite alternate;
}
.caption.VIP-caption::before, .caption.VIP-caption::after {
    content: ""; position: absolute; left: 0; width: 200%; height: 8px;
    background: repeating-linear-gradient(90deg, #ffd700 0px, #ff4500 20px, #0f0c29 40px, #ffd700 60px);
    animation: slide 1s linear infinite;
}
.caption.VIP-caption::before { top: -8px; }
.caption.VIP-caption::after { bottom: -8px; animation-direction: reverse; }

@keyframes btnNeonGlow { 
    0%, 100% { box-shadow: 0 0 7px #ff0055, 0 0 14px #00aaff; } 
    50% { box-shadow: 0 0 10px #ffff00, 0 0 20px #00ff44; } 
}
@keyframes btnGradient { 0% { background-position: 0% 50%; } 100% { background-position: 100% 50%; } }
@keyframes btnPulse { 
    0%, 100% { transform: scale(1); } 
    50% { transform: scale(1.02); } 
}

/* التعديل هنا: إزالة translateX(-50%) لترتكز العناصر الداخلية عبر flex */
.start-btn-group {
    position: fixed; bottom: 2cm; left: 50%; transform: translateX(-50%);
    z-index: 10000; width: 85%; max-width: 320px;
    display: flex; flex-direction: column; gap: 15px;
    align-items: center; /* لمركزة الأزرار */
}

/* التعديل هنا: إضافة translateX(-50%) لتحريك العناصر الفردية إذا لزم الأمر */
.start-btn, .VIP-btn {
    width: 100%; /* استخدام العرض الكامل المتاح في start-btn-group */
    padding: 12px 24px; font-size: 1.1rem; font-weight: bold; color: #fff;
    background: linear-gradient(90deg, #ff0055, #00aaff);
    background-size: 300% 300%; border: none; border-radius: 12px; cursor: pointer;
    box-shadow: 0 0 7px #ff0055, 0 0 14px #00aaff; text-align: center; 
    white-space: nowrap; letter-spacing: 0.5px;
    transition: transform 0.15s, box-shadow 0.15s; touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
    animation: btnGradient 6s infinite linear, btnPulse 1.2s infinite, btnNeonGlow 3s infinite alternate;
}
.start-btn:hover, .start-btn:active {
    transform: scale(1.02); 
    box-shadow: 0 0 10px #ff0055, 0 0 20px #ff0055, 0 0 8px #00aaff; 
}

@keyframes BtnGlowVIP { 
    0%, 100% { box-shadow: 0 0 8px #ffd700, 0 0 16px #ff4500; } 
    50% { box-shadow: 0 0 12px #ff4500, 0 0 24px #ffd700; } 
}
.VIP-btn {
    width: 100%; /* استخدام العرض الكامل المتاح في start-btn-group */
    padding: 12px 24px; font-size: 1.1rem; font-weight: bold; color: #0f0c29;
    background: linear-gradient(90deg, #ffd700, #ff4500, #ffd700);
    background-size: 300% 300%; border: none; border-radius: 12px; cursor: pointer;
    box-shadow: 0 0 8px #ffd700, 0 0 16px #ff4500; text-align: center; 
    white-space: nowrap; letter-spacing: 0.5px;
    transition: transform 0.15s, box-shadow 0.15s;
    animation: btnGradient 6s infinite linear, BtnGlowVIP 3s infinite alternate;
    color: #0f0c29 !important; /* لضمان ظهور لون النص بشكل جيد */
}
.VIP-btn:hover, .VIP-btn:active {
    transform: scale(1.02); 
    box-shadow: 0 0 12px #ffd700, 0 0 24px #ffd700, 0 0 10px #ff4500; 
}

.start-btn[disabled], .VIP-btn[disabled] { opacity: 0.6; cursor: not-allowed; }

.countdown-wrapper {
    position: absolute; left: 50%; transform: translateX(-50%);
    display: flex; align-items: center; gap: 2px; z-index: 4; 
    pointer-events: none; opacity: 0; transition: opacity 0.3s;
}
@keyframes digitalPulse { 
    0%, 100% { transform: scale(1) translateZ(0); text-shadow: 0 0 5px rgba(255, 255, 255, 0.9); opacity: 1; }
    50% { transform: scale(1.08) translateZ(0); text-shadow: 0 0 8px #fff, 0 0 16px #fff; opacity: 0.9; } 
}
.countdown-wrapper.visible #countdown { animation: digitalPulse 0.5s ease-out; }

@keyframes countdownBreathe { 
    0%, 100% { transform: translateX(-50%) scale(1); } 
    50% { transform: translateX(-50%) scale(1.02); } 
}
.project-9-countdown {
    top: calc(65% - 1.95cm); 
    animation: countdownBreathe 2.5s infinite ease-in-out;
}
.project-9-countdown .static-part, 
.project-9-countdown #countdown {
    font-size: 1.0rem; font-family: 'Share Tech Mono', monospace;
}
.project-1-8-countdown { top: calc(65% - 1.45cm); left: calc(50% + 0.2cm); }
.project-1-8-countdown .static-part, 
.project-1-8-countdown #countdown {
    font-size: 0.65rem; font-family: 'Share Tech Mono', monospace;
}
.countdown-wrapper.visible { opacity: 1 !important; }
.static-part, #countdown {
    color: white; font-weight: bold;
    text-shadow: 0 0 5px rgba(255, 255, 255, 0.9), 0 0 10px rgba(255, 255, 255, 0.7);
    letter-spacing: 0.5px; transition: color 0.3s;
}

.prediction-flash {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white;
    opacity: 0; pointer-events: none; z-index: 9999; 
    animation: flashPrediction 0.2s ease-out;
}
@keyframes flashPrediction { 0% { opacity: 0; } 10% { opacity: 0.2; } 100% { opacity: 0; } }

.VIP-page-container {
    display: flex; flex-direction: column; align-items: center; justify-content: flex-start;
    padding: 80px 20px; box-sizing: border-box; height: 100vh; width: 100%;
    overflow-y: auto; overflow-x: hidden; position: relative; z-index: 10;
    background: linear-gradient(135deg, #0a081a, #1f1a3a, #0a081a);
}
.VIP-page-container h2 {
    color: #ffd700; text-shadow: 0 0 10px #ff4500; font-size: 24px; margin-bottom: 30px;
    border-bottom: 2px solid #ff4500; padding-bottom: 10px;
}

.feature-list {
    list-style: none; padding: 0; margin: 0 0 30px 0; width: 100%; max-width: 380px;
}
.feature-list li {
    background: rgba(255, 215, 0, 0.1); padding: 15px; margin-bottom: 10px; 
    border-radius: 10px; border-left: 5px solid #ff4500;
    display: flex; align-items: center; gap: 10px; transition: transform 0.2s;
}
.feature-list li:hover { transform: translateX(-5px); }
.feature-list li strong { color: #ffd700; font-size: 16px; }
.feature-list li small { 
    color: rgba(255, 255, 255, 0.8); display: block; margin-top: 5px; 
}
.feature-icon { color: #ff4500; font-size: 20px; }

.price-table {
    width: 100%; max-width: 380px; margin-bottom: 30px;
    background: rgba(0, 0, 0, 0.3); border-radius: 10px; padding: 10px;
    border: 1px solid rgba(255, 215, 0, 0.3);
}
.price-table h3 {
    text-align: center; color: #00aaff; 
    border-bottom: 1px solid rgba(0, 170, 255, 0.3); 
    padding-bottom: 5px; margin-top: 0; font-size: 18px;
}
.price-row {
    display: flex; justify-content: space-between; padding: 10px 0;
    border-bottom: 1px dashed rgba(255, 255, 255, 0.1);
}
.price-row:last-child { border-bottom: none; }
.price-row .term { color: #e0f7ff; font-weight: bold; }
.price-row .cost { 
    color: #00ffaa; font-weight: bold; 
    text-shadow: 0 0 5px rgba(0, 255, 170, 0.5); 
}
.price-row.best-value .cost { 
    color: #ffd700; font-size: 1.1em; text-shadow: 0 0 8px #ff4500; 
}

.activation-section {
    width: 100%; max-width: 380px; padding: 20px; border-radius: 10px; 
    margin-bottom: 20px; background: rgba(48, 43, 99, 0.7);
    border: 2px solid #ff4500; box-shadow: 0 0 15px rgba(255, 69, 0, 0.5);
    direction: rtl;
}
.activation-section label { 
    color: #ffd700; display: block; margin-bottom: 8px; font-weight: bold; 
}
.activation-section input {
    width: 100%; padding: 12px; border-radius: 8px; border: none;
    background: rgba(255, 255, 255, 0.15); color: white; font-size: 16px;
    box-sizing: border-box; text-align: right; margin-bottom: 15px;
    direction: ltr; font-family: 'Share Tech Mono', monospace;
}
.activation-section input:focus { 
    outline: 2px solid #ffd700; background: rgba(255, 255, 255, 0.25); 
}

.activate-btn {
    width: 100%; padding: 12px; border-radius: 8px; border: none;
    background: linear-gradient(90deg, #ffd700, #ff4500);
    color: #0f0c29; font-weight: bold; font-size: 1.1rem; cursor: pointer;
    transition: background-color 0.2s, transform 0.1s;
}
.activate-btn:active { transform: scale(0.98); }

@keyframes whatsappPulse { 
    0%, 100% { transform: scale(1); box-shadow: 0 0 10px rgba(37, 211, 102, 0.7); } 
    50% { transform: scale(1.03); box-shadow: 0 0 15px rgba(37, 211, 102, 1); }
}
.whatsapp-btn {
    width: 100%; max-width: 380px; padding: 15px; border-radius: 12px; 
    border: none; background: linear-gradient(90deg, #25D366, #128C7E);
    color: white; font-weight: bold; font-size: 1.1rem; cursor: pointer; 
    margin-top: 15px; transition: transform 0.15s, box-shadow 0.15s;
    display: flex; justify-content: center; align-items: center; gap: 10px;
    animation: whatsappPulse 2s infinite alternate;
}
.whatsapp-btn:hover { background: linear-gradient(90deg, #128C7E, #25D366); }
.whatsapp-icon { width: 20px; height: 20px; fill: white; }
</style>
</head>
<body>

<div class="stars" id="stars-effect"></div>
<div class="rain" id="rainContainer"></div>
<div id="toast-container" class="toast-container"></div> 
<div id="loadingScreen" style="display: none;">
    <div id="loadingText">جـاري التـحمـيل</div>
    <div id="loadingSpinner"></div>
</div>
<audio id="backgroundMusic" loop preload="auto" style="display:none;">
    <source src="https://github.com/abanoub02230265/nsnsnnsjsj/raw/main/lv_0_%D9%A2%D9%A0%D9%A2%D9%A5%D9%A1%D9%A0%D9%A0%D9%A2%D9%A2%D9%A1%D9%A2%D9%A1%D9%A5%D9%A5.mp3" type="audio/mpeg">
</audio>

<div class="VIP-banner-strip" id="BannerStripVIP">
    <div class="VIP-banner-inner" id="BannerInnerVIP">
        <div class="VIP-banner" onclick="openPageVIP()">
            <div class="VIP-banner-text"><span class="VIP-icon-star">✨</span> توقع 100% بدلاً من 80% الآن! <span class="VIP-icon-star">💯</span></div>
        </div>
        <div class="VIP-banner" onclick="openPageVIP()">
            <div class="VIP-banner-text"><span class="VIP-icon-star">🚀</span>VIP لتجربة توقعات لا بديل  لها اشترك في <span class="VIP-icon-star">💎</span></div>
        </div>
        <div class="VIP-banner" onclick="openPageVIP()">
            <div class="VIP-banner-text"><span class="VIP-icon-star">🤖</span> تفعيل دعم الذكاء الاصطناعي الفائق. <span class="VIP-icon-star">⚡</span></div>
        </div>
        <div class="VIP-banner" onclick="openPageVIP()">
            <div class="VIP-banner-text"><span class="VIP-icon-star">💰</span> احصل على الخصم الأكبر في باقة السنة. <span class="VIP-icon-star">👑</span></div>
        </div>
    </div>
</div>

<div class="sidebar" id="sidebar">
    <button class="close-btn" onclick="toggleSidebar()">✖</button>
    <h2>الاعـدادات</h2>
    <div class="sidebar-control-item">
        <div class="control-info VIP">
            <p>حالة VIP  </p>
            <small id="VIP-status-display">غير مفعلة</small>
        </div>
        <button class="activate-btn" style="width: 100px; padding: 8px; font-size: 14px; margin: 0; background: #ff4500;" onclick="openPageVIP()">ترقية VIP</button>
    </div>
    <div class="sidebar-control-item">
        <div class="control-info">
            <p>تأثير خلفية القائمة</p>
            <small>تشغيل/إيقاف لمعان الخلفية النيون للقائمة الجانبية.</small>
        </div>
        <label class="toggle-switch">
            <input type="checkbox" id="sidebar-glow-toggle" onchange="toggleEffect('sidebar-glow', this.checked)">
            <span class="slider"></span>
        </label>
    </div>
    <div class="sidebar-control-item">
        <div class="control-info">
            <p>تأثير قطرات المطر</p>
            <small>إيقاف/تشغيل رسوم المطر الساقط في الخلفية.</small>
        </div>
        <label class="toggle-switch">
            <input type="checkbox" id="rain-toggle" onchange="toggleEffect('rain', this.checked)">
            <span class="slider"></span>
        </label>
    </div>
    <div class="sidebar-control-item">
        <div class="control-info">
            <p>تأثير النجوم المتلألئة</p>
            <small>إيقاف/تشغيل النجوم الساقط في الخلفية.</small>
        </div>
        <label class="toggle-switch">
            <input type="checkbox" id="stars-toggle" onchange="toggleEffect('stars', this.checked)">
            <span class="slider"></span>
        </label>
    </div>
    <div class="sidebar-control-item">
        <div class="control-info">
            <p>تأثير لمعان النيون</p>
            <small>إيقاف/تشغيل تأثير الإضاءة على الأيقونات.</small>
        </div>
        <label class="toggle-switch">
            <input type="checkbox" id="neon-toggle" onchange="toggleEffect('neon', this.checked)">
            <span class="slider"></span>
        </label>
    </div>
    <div class="sidebar-control-item">
        <div class="control-info">
            <p>اهتزاز الصورة</p>
            <small>إيقاف/تشغيل اهتزاز الصورة الخفيف في صفحات الالعاب</small>
        </div>
        <label class="toggle-switch">
            <input type="checkbox" id="jitter-toggle" onchange="toggleEffect('jitter', this.checked)">
            <span class="slider"></span>
        </label>
    </div>
</div>

<div class="search-wrapper" id="searchWrapper">
    <div class="search-wrapper-inner">
        <button id="sidebar-btn" onclick="toggleSidebar()">☰</button> 
        <input type="text" id="searchInput" placeholder="...أبـحث عـن إسـم التـطـبيـق" oninput="filterIcons()">
    </div>
</div>

<div class="container" id="mainInterface">
    <div class="icon-grid" id="iconGrid">
        <div class="icon-item" data-name="VIP" data-icon-id="0">
            <div class="fixed-logo VIP-logo" onclick="openPageVIP()">VIP</div>
            <div class="icon-label icon-label-VIP">VIP <div class="user-count" id="users-0" style="display:none;"></div></div>
        </div>
        <div class="icon-item" data-name="TopTop KSA" data-icon-id="1">
            <img class="fixed-logo" src="https://iili.io/K1o0nse.th.webp" alt="TopTop KSA" onclick="handleIconClick(1)">
            <div class="icon-label">TopTop KSA <div class="user-count" id="users-1"><svg viewBox="0 0 20 20"><path d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" fill-rule="evenodd"></path></svg><span class="user-count-number">0</span></div></div>
        </div>
        <div class="icon-item" data-name="TopTop" data-icon-id="2">
            <img class="fixed-logo" src="https://i.postimg.cc/c6P5F4gb/image.png" alt="TopTop" onclick="handleIconClick(2)">
            <div class="icon-label">TopTop <div class="user-count" id="users-2"><svg viewBox="0 0 20 20"><path d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" fill-rule="evenodd"></path></svg><span class="user-count-number">0</span></div></div>
        </div>
        <div class="icon-item" data-name="Hello Yo" data-icon-id="9">
            <img class="fixed-logo" src="https://iili.io/KECYcYu.th.webp" alt="Hello Yo" onclick="handleIconClick(9)">
            <div class="icon-label">Hello Yo <div class="user-count" id="users-9"><svg viewBox="0 0 20 20"><path d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" fill-rule="evenodd"></path></svg><span class="user-count-number">0</span></div></div>
        </div>
        <div class="icon-item" data-name="4Fun Lite" data-icon-id="10">
            <img class="fixed-logo" src="https://iili.io/KECcsIf.th.jpg" alt="4Fun Lite" onclick="handleIconClick(10)">
            <div class="icon-label">4Fun Lite <div class="user-count" id="users-10"><svg viewBox="0 0 20 20"><path d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" fill-rule="evenodd"></path></svg><span class="user-count-number">0</span></div></div>
        </div>
        <div class="icon-item" data-name="Xena leve" data-icon-id="3">
            <img class="fixed-logo" src="https://i.postimg.cc/148j0NtF/image.png" alt="Xena leve" onclick="handleIconClick(3)">
            <div class="icon-label">Xena leve <div class="user-count" id="users-3"><svg viewBox="0 0 20 20"><path d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" fill-rule="evenodd"></path></svg><span class="user-count-number">0</span></div></div>
        </div>
        <div class="icon-item" data-name="YoHo" data-icon-id="4">
            <img class="fixed-logo" src="https://iili.io/K1oXtol.th.jpg" alt="YoHo" onclick="handleIconClick(4)">
            <div class="icon-label">YoHo <div class="user-count" id="users-4"><svg viewBox="0 0 20 20"><path d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" fill-rule="evenodd"></path></svg><span class="user-count-number">0</span></div></div>
        </div>
        <div class="icon-item" data-name="Taka" data-icon-id="11">
            <img class="fixed-logo" src="https://iili.io/KEC1S1V.th.png" alt="Taka" onclick="handleIconClick(11)">
            <div class="icon-label">Taka <div class="user-count" id="users-11"><svg viewBox="0 0 20 20"><path d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" fill-rule="evenodd"></path></svg><span class="user-count-number">0</span></div></div>
        </div>
        <div class="icon-item" data-name="Upfun" data-icon-id="12">
            <img class="fixed-logo" src="https://iili.io/KECEnY7.th.webp" alt="Upfun" onclick="handleIconClick(12)">
            <div class="icon-label">Upfun <div class="user-count" id="users-12"><svg viewBox="0 0 20 20"><path d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" fill-rule="evenodd"></path></svg><span class="user-count-number">0</span></div></div>
        </div>
        <div class="icon-item" data-name="Hiya Game" data-icon-id="5">
            <img class="fixed-logo" src="https://iili.io/K1oMOu4.th.webp" alt="Hiya Game" onclick="handleIconClick(5)">
            <div class="icon-label">Hiya Game <div class="user-count" id="users-5"><svg viewBox="0 0 20 20"><path d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" fill-rule="evenodd"></path></svg><span class="user-count-number">0</span></div></div>
        </div>
        <div class="icon-item" data-name="SUGO" data-icon-id="6">
            <img class="fixed-logo" src="https://iili.io/K1ojz1S.th.webp" alt="SUGO" onclick="handleIconClick(6)">
            <div class="icon-label">SUGO <div class="user-count" id="users-6"><svg viewBox="0 0 20 20"><path d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" fill-rule="evenodd"></path></svg><span class="user-count-number">0</span></div></div>
        </div>
        <div class="icon-item" data-name="Wafa" data-icon-id="13">
            <img class="fixed-logo" src="https://iili.io/KECW6xe.th.webp" alt="Wafa" onclick="handleIconClick(13)">
            <div class="icon-label">Wafa <div class="user-count" id="users-13"><svg viewBox="0 0 20 20"><path d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" fill-rule="evenodd"></path></svg><span class="user-count-number">0</span></div></div>
        </div>
        <div class="icon-item" data-name="Light Chat" data-icon-id="14">
            <img class="fixed-logo" src="https://iili.io/KECjRNS.th.jpg" alt="Light Chat" onclick="handleIconClick(14)">
            <div class="icon-label">Light Chat <div class="user-count" id="users-14"><svg viewBox="0 0 20 20"><path d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" fill-rule="evenodd"></path></svg><span class="user-count-number">0</span></div></div>
        </div>
        <div class="icon-item" data-name="Mico Lite" data-icon-id="7">
            <img class="fixed-logo" src="https://iili.io/K1owoua.th.webp" alt="Mico Lite" onclick="handleIconClick(7)">
            <div class="icon-label">Mico Lite <div class="user-count" id="users-7"><svg viewBox="0 0 20 20"><path d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" fill-rule="evenodd"></path></svg><span class="user-count-number">0</span></div></div>
        </div>
        <div class="icon-item" data-name="SoMatch" data-icon-id="8">
            <img class="fixed-logo" src="https://iili.io/K1oN1J1.th.jpg" alt="SoMatch" onclick="handleIconClick(8)">
            <div class="icon-label">SoMatch <div class="user-count" id="users-8"><svg viewBox="0 0 20 20"><path d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" fill-rule="evenodd"></path></svg><span class="user-count-number">0</span></div></div>
        </div>
        <div class="icon-item" data-name="Ahlan" data-icon-id="15">
            <img class="fixed-logo" src="https://iili.io/KECNuZ7.th.jpg" alt="Ahlan" onclick="handleIconClick(15)">
            <div class="icon-label">Ahlan <div class="user-count" id="users-15"><svg viewBox="0 0 20 20"><path d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" fill-rule="evenodd"></path></svg><span class="user-count-number">0</span></div></div>
        </div>
        <div class="icon-item" data-name="SOYO" data-icon-id="16">
            <img class="fixed-logo" src="https://iili.io/KECOb5v.th.jpg" alt="SOYO" onclick="handleIconClick(16)">
            <div class="icon-label">SOYO <div class="user-count" id="users-16"><svg viewBox="0 0 20 20"><path d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" fill-rule="evenodd"></path></svg><span class="user-count-number">0</span></div></div>
        </div>
    </div>
</div>

<script>
const VIP_KEY = 'app_VIP_status_v2';
const DEVICE_ID_KEY = 'app_device_id';
const EFFECTS_KEY = 'app_visual_effects_v2';
const DEFAULT_EFFECTS = { 'rain': true, 'stars': true, 'neon': false, 'jitter': true, 'sidebar-glow': true };

let isActiveVIP = false;
let DEVICE_ID;
let currentBannerIndex = 0;
let bannerInterval;
let previousPage = null;
let isMusicReady = false;
let isOnline = navigator.onLine;
let isSearching = false;
let userCountInterval;
let currentEffectsState = {};
const currentUsers = {};
const iconIDs = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16];

const backgroundMusic = document.getElementById('backgroundMusic');
const rainContainer = document.getElementById('rainContainer');
const sidebar = document.getElementById('sidebar');

// الأكواد الجديدة المطلوبة
const VIP_CODES = [
    { id: 1, code: 'dhnsndjd' },
    { id: 2, code: 'dnkxbdvdn' },
    { id: 3, code: 'ozbsbdbdn' },
    { id: 4, code: 'osjssndnbd' },
    { id: 5, code: 'kzjxndndnb' },
    { id: 6, code: 'kxxjxbnxbdb' },
    { id: 7, code: 'djdjdjjdjdjdn' },
    { id: 8, code: 'hddjjdiebebr' },
    { id: 9, code: 'sisbrhodksk' },
    { id: 10, code: 'kzjsbrhfidnb' },
    { id: 11, code: 'ozlsnerbdjko' },
    { id: 12, code: 'sllsrnbdndjd' },
    { id: 13, code: 'osndbrbjfjjd' },
    { id: 14, code: 'isjddndnndn' },
    { id: 15, code: 'ozjdbdndbfj' },
    { id: 16, code: 'zkdnndndnd' },
    { id: 17, code: 'zidjdndndnn' },
    { id: 18, code: 'djjdjdjdjdjdjd' },
    { id: 19, code: 'kzdbbdndkdk' },
    { id: 20, code: 'isjdndndndjkd' }
];

function getDeviceId() {
    let id = localStorage.getItem(DEVICE_ID_KEY);
    if (!id) {
        id = 'DEV-' + Date.now().toString(36) + Math.random().toString(36).substring(2, 7);
        localStorage.setItem(DEVICE_ID_KEY, id);
    }
    return id;
}

function checkStatusVIP() {
    DEVICE_ID = getDeviceId();
    const DataVIP = JSON.parse(localStorage.getItem(VIP_KEY));
    const now = Date.now();
    
    isActiveVIP = false;
    
    if (DataVIP && DataVIP.expiryTime > now && DataVIP.deviceId === DEVICE_ID) {
        isActiveVIP = true;
    } else if (DataVIP && DataVIP.expiryTime <= now) {
        localStorage.removeItem(VIP_KEY);
    }
    
    updateVisualsVIP();
    return isActiveVIP;
}

function activateVIP(code) {
    const enteredCode = code.trim().toLowerCase();
    const now = Date.now();
    const duration = 30 * 24 * 60 * 60 * 1000;
    
    const validCode = VIP_CODES.find(item => item.code.toLowerCase() === enteredCode);
    
    if (validCode) {
        const allUsedCodes = JSON.parse(localStorage.getItem('used_VIP_codes') || '[]');
        const usedCodeData = allUsedCodes.find(data => data.codeId === validCode.id);

        if (usedCodeData && usedCodeData.deviceId !== DEVICE_ID) {
            showToast("❌ هذا الكود مفعل بالفعل على جهاز آخر!", 4000, 'VIP-error');
            return;
        }

        const expiryTime = now + duration;
        const DataVIP = { codeId: validCode.id, deviceId: DEVICE_ID, expiryTime: expiryTime };
        
        localStorage.setItem(VIP_KEY, JSON.stringify(DataVIP));
        
        if (!usedCodeData) {
            allUsedCodes.push({ codeId: validCode.id, deviceId: DEVICE_ID, activationTime: now });
            localStorage.setItem('used_VIP_codes', JSON.stringify(allUsedCodes));
        }

        isActiveVIP = true;
        updateVisualsVIP();
        showToast("✅ تم تفعيل VIP بنجاح! توقع 100% لمدة شهر. 👑", 5000, 'VIP-success');
        
        if (previousPage && previousPage.type === 'project') {
             openNewPage(previousPage.iconNumber);
        } else {
             showMainInterface(true);
        }
    } else {
        showToast("❌ كود التفعيل غير صحيح أو انتهت صلاحيته.", 3000, 'VIP-error');
    }
}

function updateVisualsVIP() {
    const LogoVIP = document.querySelector('.VIP-logo');
    const statusDisplay = document.getElementById('VIP-status-display');
    const logos = document.querySelectorAll('.fixed-logo:not(.VIP-logo)');
    const labels = document.querySelectorAll('.icon-label:not(.icon-label-VIP)');
    
    if (LogoVIP) LogoVIP.textContent = isActiveVIP ? '👑' : 'VIP';
    if (statusDisplay) {
        statusDisplay.textContent = isActiveVIP ? 'مفعلة ✅' : 'غير مفعلة 🔒';
        statusDisplay.style.color = isActiveVIP ? '#00ffaa' : '#ff4500';
    }
    
    logos.forEach(logo => logo.classList.toggle('VIP-active', isActiveVIP));
    labels.forEach(label => label.classList.toggle('VIP-active-label', isActiveVIP));
}

function startBannerSlider() {
    const bannerInner = document.getElementById('BannerInnerVIP');
    if (!bannerInner) return;
    
    if (bannerInterval) clearInterval(bannerInterval);
    
    bannerInterval = setInterval(() => {
        currentBannerIndex = (currentBannerIndex + 1);
        bannerInner.style.transition = 'transform 0.5s ease-in-out';
        bannerInner.style.transform = `translateX(${-currentBannerIndex * 100}%)`;
        
        if (currentBannerIndex >= bannerInner.children.length / 2) { 
            setTimeout(() => {
                bannerInner.style.transition = 'none';
                bannerInner.style.transform = `translateX(0)`;
                currentBannerIndex = 0;
            }, 500); 
        }
    }, 3000); 
}

function createRainDrops() {
    rainContainer.innerHTML = ''; 
    for (let i = 0; i < 100; i++) {
        const drop = document.createElement('div');
        drop.className = 'drop';
        drop.style.left = Math.random() * 100 + 'vw';
        drop.style.animationDuration = 0.8 + Math.random() * 1 + 's';
        drop.style.animationDelay = Math.random() * 2 + 's';
        rainContainer.appendChild(drop);
    }
}

backgroundMusic.oncanplaythrough = () => {
    isMusicReady = true;
    checkInitialConditions();
};

function playMusic() {
    if (!navigator.onLine || !backgroundMusic) return;
    const playPromise = backgroundMusic.play();
    if (playPromise !== undefined) {
        playPromise.then(() => {
            isMusicReady = true;
            checkInitialConditions();
        }).catch(() => {
            isMusicReady = false;
            showToast("⚠️ الرجاء النقر على الشاشة لتشغيل الموسيقى", 4000);
        });
    }
}

function pauseMusic() { if (backgroundMusic) backgroundMusic.pause(); }

function toggleLoadingScreen(show, text = "جـاري التـحمـيل") {
    const loading = document.getElementById('loadingScreen');
    const loadingText = document.getElementById('loadingText');
    loadingText.textContent = text; 
    if (show) {
        loading.style.display = 'flex';
        setTimeout(() => loading.style.opacity = '1', 10); 
    } else {
        loading.style.opacity = '0';
        setTimeout(() => loading.style.display = 'none', 150);
    }
}

function checkOnlineStatus() {
    const wasOnline = isOnline;
    isOnline = navigator.onLine;
    
    const icons = document.querySelectorAll('.icon-item');
    if (!isOnline) {
        if (wasOnline) pauseMusic();
        icons.forEach(icon => {
            if (icon.getAttribute('data-icon-id') !== '0') {
                icon.style.opacity = '0.5';
                icon.style.cursor = 'not-allowed';
            }
        });
    } else {
        icons.forEach(icon => {
             icon.style.opacity = '1';
             icon.style.cursor = 'pointer';
        });
        
        if (document.getElementById('mainInterface').style.display !== 'none' && !backgroundMusic.playing) {
            playMusic();
        }
    }
    return isOnline;
}

window.addEventListener('online', checkOnlineStatus);
window.addEventListener('offline', checkOnlineStatus);

function getRealTimeUsers(iconNumber) {
    if (!isOnline || iconNumber === 0) return 0; 
    if (iconNumber >= 1 && iconNumber <= 9) {
        let current = currentUsers[iconNumber] || 0;
        const MAX_USERS = 500;
        const MIN_USERS = 5; 
        let change = Math.floor(Math.random() * 11) - 5; 
        let newCount = current + change;
        newCount = Math.max(MIN_USERS, Math.min(MAX_USERS, newCount));
        currentUsers[iconNumber] = newCount;
        return newCount; 
    }
    return 0;
}

function updateIconUserCount(iconNumber, count) {
    const userCountElement = document.getElementById(`users-${iconNumber}`);
    if (userCountElement) {
        const numberSpan = userCountElement.querySelector('.user-count-number');
        const oldText = numberSpan.textContent;
        const newText = count.toString();
        
        if (count >= 50) {
            userCountElement.classList.add('high-activity');
        } else {
            userCountElement.classList.remove('high-activity');
        }
        
        if (oldText !== newText && (iconNumber >= 1 && iconNumber <= 9)) {
            numberSpan.textContent = newText;
            numberSpan.classList.add('pulse');
            setTimeout(() => numberSpan.classList.remove('pulse'), 300);
        } else if (!(iconNumber >= 1 && iconNumber <= 9)) {
             numberSpan.textContent = 0;
        }
    }
}

function startUserCountUpdates() {
    iconIDs.forEach(id => {
        if (id >= 1 && id <= 9) {
            currentUsers[id] = Math.floor(Math.random() * 150) + 10;
        } else {
            currentUsers[id] = 0;
        }
    });

    if (userCountInterval) clearInterval(userCountInterval);
    
    function runUpdate() {
        iconIDs.forEach(id => {
            const count = getRealTimeUsers(id);
            updateIconUserCount(id, count);
        });
    }
    
    runUpdate();
    userCountInterval = setInterval(runUpdate, 5000);
}

function toggleSidebar() { if (sidebar) sidebar.classList.toggle('open'); }

function showToast(message, duration = 2000, type = '') {
    const container = document.getElementById('toast-container');
    const toast = document.createElement('div');
    toast.className = 'toast';
    if (type) toast.classList.add(type);
    toast.textContent = message;
    
    container.appendChild(toast);
    setTimeout(() => { toast.classList.add('show'); }, 10);
    setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => toast.remove(), 300); 
    }, duration);
}

function saveEffectsState() {
    try { localStorage.setItem(EFFECTS_KEY, JSON.stringify(currentEffectsState)); }
    catch (e) { console.error("Could not save effects state:", e); }
}

function loadEffectsState() {
    try {
        const savedState = localStorage.getItem(EFFECTS_KEY);
        currentEffectsState = savedState ? JSON.parse(savedState) : {...DEFAULT_EFFECTS};
    } catch (e) {
        currentEffectsState = {...DEFAULT_EFFECTS};
    }
    
    Object.keys(DEFAULT_EFFECTS).forEach(effect => { 
        const isChecked = currentEffectsState[effect] !== undefined ? currentEffectsState[effect] : DEFAULT_EFFECTS[effect];
        currentEffectsState[effect] = isChecked; 
        
        const toggleEl = document.getElementById(`${effect}-toggle`);
        if (toggleEl) toggleEl.checked = isChecked;
        applyEffectVisual(effect, isChecked, false);
    });
    saveEffectsState();
}

function applyEffectVisual(effect, isChecked, showToastMessage = true) {
    let message = '';
    
    switch(effect) {
        case 'sidebar-glow':
            if (sidebar) {
                sidebar.classList.toggle('effect-active', isChecked);
                message = "خلفية القائمة: تم " + (isChecked ? "تفعيل التأثير 🎇" : "إيقاف التأثير 🎨");
            }
            break;
        case 'rain':
            if (isChecked) {
                rainContainer.style.display = 'block';
                createRainDrops();
                message = "تأثير المطر: تم التشغيل ✨";
            } else {
                rainContainer.style.display = 'none';
                rainContainer.innerHTML = '';
                message = "تأثير المطر: تم الإيقاف ⛔";
            }
            break;
        case 'stars':
            const starsEffect = document.getElementById('stars-effect');
            if (starsEffect) {
                starsEffect.style.display = isChecked ? 'block' : 'none';
                message = "تأثير النجوم: تم " + (isChecked ? "التشغيل 🌌" : "الإيقاف ⛔");
            }
            break;
        case 'neon':
            const logos = document.querySelectorAll('.fixed-logo');
            logos.forEach(logo => logo.classList.toggle('neon-active', isChecked));
            message = "تأثير النيون: تم " + (isChecked ? "التشغيل 💡" : "الإيقاف 🔌");
            break;
        case 'jitter':
            message = "اهتزاز الصورة: تم " + (isChecked ? "التشغيل ⚡" : "الإيقاف 🛑");
            break;
    }
    
    if (showToastMessage) showToast(message);
}

function toggleEffect(effect, isChecked) {
    if (!isOnline) {
        const toggleEl = document.getElementById(`${effect}-toggle`);
        if (toggleEl) toggleEl.checked = !isChecked; 
        showToast("❌ يجب توفر اتصال بالإنترنت لتغيير إعدادات التحكم!", 3000);
        return;
    }
    
    currentEffectsState[effect] = isChecked;
    applyEffectVisual(effect, isChecked, true);
    saveEffectsState();
}

let touchstartX = 0, touchendX = 0, touchstartY = 0, touchendY = 0;
const SWIPE_THRESHOLD = 50, SWIPE_VERTICAL_LIMIT = 30;

function checkSwipe() {
    const swipeDistanceX = touchendX - touchstartX;
    const swipeDistanceY = Math.abs(touchendY - touchstartY);
    
    if (swipeDistanceY > SWIPE_VERTICAL_LIMIT || Math.abs(swipeDistanceX) < SWIPE_THRESHOLD) return;
    
    if (swipeDistanceX < -SWIPE_THRESHOLD) { 
        if (sidebar.classList.contains('open')) toggleSidebar();
    } else if (swipeDistanceX > SWIPE_THRESHOLD) { 
        if (!sidebar.classList.contains('open')) toggleSidebar();
    }
}

document.addEventListener('touchstart', e => {
    if (sidebar.classList.contains('open') && e.target.closest('.sidebar')) return;
    touchstartX = e.changedTouches[0].screenX;
    touchstartY = e.changedTouches[0].screenY;
}, false);

document.addEventListener('touchend', e => {
    if (sidebar.classList.contains('open') && e.target.closest('.sidebar')) return;
    touchendX = e.changedTouches[0].screenX;
    touchendY = e.changedTouches[0].screenY;
    checkSwipe();
}, false);

const projectHTMLTemplate = (iconNumber) => {
    const isProject9 = iconNumber === 9;
    const isVIP = isActiveVIP; 
    
    const imgSrc = isProject9 ? "https://iili.io/KElpwXV.md.jpg" : "https://iili.io/KlKYUQt.md.jpg";
    const countdownValue = isProject9 ? 30 : 20;
    const countdownClass = isProject9 ? 'project-9-countdown' : 'project-1-8-countdown';
    const captionClass = isVIP ? 'VIP-caption' : (isProject9 ? '' : 'project-1-8');
    const captionText = isVIP ? "توقع بنسبة 100/100 (VIP)" : "توقع بنسبة 80/100";
    const imageWrapperClass = isVIP ? 'VIP-active-page' : '';
    
    return `
        <div id="newPage" style="width:100%; height:100%; position:relative;">
            <button class="close-btn" style="position: absolute; top: 20px; right: 20px; z-index: 10001;" onclick="showMainInterface(true)">✖</button>
            <div class="liquid-bg"></div>
            <div class="stars"></div>

            <section class="image-container">
                <div class="image-wrapper ${imageWrapperClass}" id="imageWrapper">
                    <div class="countdown-wrapper ${countdownClass}" id="countdownWrapper">
                        <span class="static-part">S.</span>
                        <span id="countdown">${countdownValue}</span>
                    </div>
                    <img src="${imgSrc}" alt="الصورة الكاملة">
                    <div class="falling-emoji emoji-right">🐮</div>
                    <div class="falling-emoji emoji-left">🍤</div>
                    ${Array.from({length: 8}, (_, i) => `<div id="emoji-${i+1}" class="emoji ${isVIP ? 'VIP-emoji' : ''}">😈</div>`).join('')}
                    <div id="rare-indicator" class="rare-indicator ${isVIP ? 'VIP-indicator' : ''}">تائمين</div>
                    <div class="caption ${captionClass}">${captionText}</div>
                </div>
            </section>

            <div class="start-btn-group">
                <button id="BtnVIP" class="VIP-btn" style="display:${isVIP ? 'none' : 'block'};" onclick="openPageVIP()">100% VIP بدء توقع</button>
                <button id="startBtn" class="start-btn">80% بدء توقع عادي</button>
            </div>
        </div>
    `;
};

function filterIcons() {
    const searchInput = document.getElementById('searchInput');
    const filter = searchInput.value.toUpperCase().trim();
    const iconItems = document.getElementById('iconGrid').getElementsByClassName('icon-item');
    const wasSearching = isSearching;

    isSearching = filter.length > 0;

    if (isSearching && !wasSearching) {
        history.pushState({ page: 'search' }, 'نتائج البحث', '#search');
    } 

    Array.from(iconItems).forEach(item => {
        const name = item.getAttribute('data-name').toUpperCase();
        item.classList.toggle('hidden', !name.includes(filter));
    });
}

function executeProjectJS(iconNumber) {
    const isProject9 = iconNumber === 9;
    const isVIP = isActiveVIP;
    
    const positions = {
      '1': { top: 'calc(45% + 120px)', right: 'calc(15% + 98px)' }, 
      '2': { top: 'calc(45% + 83px)', right: 'calc(15% + 10px)' },   
      '3': { top: 'calc(45% + 38px - 1cm)', right: 'calc(15% + 10px - 1cm)' },
      '4': { top: 'calc(45% + 38px - 3.5cm)', right: 'calc(15% + 10px)' }, 
      '5': { top: 'calc(45% + 38px - 4.5cm)', right: 'calc(15% + 10px + 2.45cm)' },
      '6': { top: 'calc(45% + 38px - 3.5cm)', right: 'calc(15% + 10px + 4.85cm)' },
      '7': { top: 'calc(45% + 38px - 1.25cm)', right: 'calc(15% + 10px + 5.85cm)' },
      '8': { top: 'calc(45% + 38px + 1.25cm)', right: 'calc(15% + 10px + 4.65cm)' } 
    };

    Object.keys(positions).forEach(id => {
      const elem = document.getElementById('emoji-' + id);
      if (elem) {
        elem.style.top = positions[id].top;
        elem.style.right = positions[id].right;
      }
    });

    let isRunning = false;
    let countdownInterval = null;

    const countdownEl = document.getElementById('countdown');
    const staticPartEl = document.querySelector('.static-part');
    const countdownWrapper = document.getElementById('countdownWrapper');
    const btn = document.getElementById('startBtn');
    const imageWrapper = document.getElementById('imageWrapper');
    const emojis = Array.from({length: 8}, (_, i) => document.getElementById('emoji-' + (i+1))).filter(e => e);
    const rareIndicator = document.getElementById('rare-indicator');
    const allEmojiIDs = [1, 2, 3, 4, 5, 6, 7, 8];
    
    const startCountValue = isProject9 ? 30 : 20;
    const meats = [1, 3, 5, 7];   
    const veggies = [2, 4, 6, 8]; 

    function hideEmojis() {
        emojis.forEach(el => { if (el) el.classList.remove('show'); });
        if (rareIndicator) rareIndicator.classList.remove('active');
    }
    
    function resetAll() {
        if (countdownWrapper) countdownWrapper.classList.remove('visible');
        if (countdownEl) countdownEl.textContent = startCountValue;
        if (staticPartEl) staticPartEl.textContent = 'S.';
        if (countdownEl) countdownEl.style.color = 'white';
        if (staticPartEl) staticPartEl.style.color = 'white';
        if (imageWrapper) imageWrapper.classList.remove('jitter-active');
        hideEmojis();
        isRunning = false;
        if (btn) btn.textContent = '80% بدء توقع عادي';
        if (btn) btn.disabled = false;
        if (countdownInterval) clearTimeout(countdownInterval); 
    }
    
    function choose3() {
      if (isVIP) {
          const selected = new Set();
          while (selected.size < 3) {
              selected.add(allEmojiIDs[Math.floor(Math.random() * allEmojiIDs.length)]);
          }
          return Array.from(selected);
      } else if (isProject9) {
          const pool = [];
          [2, 2, 2].forEach(id => pool.push(id)); 
          [3, 3, 3, 3, 3, 3].forEach(id => pool.push(id)); 
          [4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4].forEach(id => pool.push(id)); 
          for (let i = 0; i < 25; i++) { pool.push(5); } 
          for (let i = 0; i < 40; i++) { pool.push(1); pool.push(6); pool.push(7); pool.push(8); } 
          
          const selected = new Set();
          while (selected.size < 3 && pool.length > 0) {
              const idx = Math.floor(Math.random() * pool.length);
              selected.add(pool[idx]);
              pool.splice(idx, 1);
          }
          let backupIndex = 0;
          while (selected.size < 3) {
              if (!selected.has(allEmojiIDs[backupIndex])) {
                  selected.add(allEmojiIDs[backupIndex]);
              }
              backupIndex = (backupIndex + 1) % allEmojiIDs.length;
          }
          return Array.from(selected);
      } else {
        const pool = [];
        for (let i = 0; i < 12; i++) { pool.push(...veggies); } 
        for (let i = 0; i < 5; i++) { pool.push(7); } 
        for (let i = 0; i < 4; i++) { pool.push(3); } 
        for (let i = 0; i < 2; i++) { pool.push(1); } 
        pool.push(5); 
        
        const selected = new Set();
        let attempts = 0;
        
        while (selected.size < 3 && attempts < 100) {
            const idx = Math.floor(Math.random() * pool.length);
            const emojiID = pool[idx];
            
            const currentlySelectedMeats = Array.from(selected).filter(id => meats.includes(id)).length;
            const isMeat = meats.includes(emojiID);

            if (isMeat && currentlySelectedMeats >= 1 && Math.random() < 0.95) {
                attempts++;
                continue; 
            }
            selected.add(emojiID);
            for(let i = 0; i < pool.length; i++){
                if(pool[i] === emojiID){
                    pool.splice(i, 1);
                    i--; 
                }
            }
            attempts++;
        }
        
        const backupOrder = [...veggies, ...meats];
        let backupIndex = 0;
        while (selected.size < 3) {
            if (!selected.has(backupOrder[backupIndex])) {
                selected.add(backupOrder[backupIndex]);
            }
            backupIndex = (backupIndex + 1) % backupOrder.length;
        }
        return Array.from(selected);
      }
    }
    
    function showEmojis(selectedIDs) {
        hideEmojis();
        
        const nonSelected = allEmojiIDs.filter(id => !selectedIDs.includes(id));
        let rareEmojiID = null;

        if (nonSelected.length > 0) {
             rareEmojiID = nonSelected[Math.floor(Math.random() * nonSelected.length)];
        }
        
        selectedIDs.forEach(num => {
            const el = document.getElementById(`emoji-${num}`);
            if (el) setTimeout(() => el.classList.add('show'), Math.random() * 200);
        });

        if (rareEmojiID) {
            const rareEl = document.getElementById(`emoji-${rareEmojiID}`);
            if (rareEl && rareIndicator) {
                setTimeout(() => {
                    const rect = rareEl.getBoundingClientRect();
                    const wrapperRect = rareEl.parentElement.getBoundingClientRect();
                    const relativeTop = rect.top - wrapperRect.top - rareIndicator.offsetHeight + 10; 
                    const relativeRight = wrapperRect.right - rect.right - (rareEl.offsetWidth / 2) + (rareIndicator.offsetWidth / 2);

                    rareIndicator.style.top = `${relativeTop}px`;
                    rareIndicator.style.right = `${relativeRight}px`;
                    rareIndicator.classList.add('active'); 
                    rareEl.classList.add('show');
                }, Math.random() * 200);
            }
        }
    }

    let currentCount = startCountValue;

    function startSimpleCountdown() {
        if (isRunning) return; 

        const flash = document.createElement('div');
        flash.className = 'prediction-flash';
        document.body.appendChild(flash);
        setTimeout(() => { if (flash.parentNode) flash.parentNode.removeChild(flash); }, 200);

        const chosen = choose3();
        showEmojis(chosen);
        
        isRunning = true;
        if (countdownWrapper) countdownWrapper.classList.add('visible');
        
        if (currentEffectsState.jitter && imageWrapper) imageWrapper.classList.add('jitter-active');

        currentCount = startCountValue;
        if (countdownEl) countdownEl.textContent = currentCount;
        if (btn) btn.textContent = 'تم التوقع'; 
        if (btn) btn.disabled = true; 

        const COUNTDOWN_INTERVAL = 500; 

        const runInterval = () => {
            if (!isRunning) return;
            
            currentCount--;
            if (countdownEl) {
                countdownEl.textContent = currentCount < 0 ? 0 : currentCount;
                countdownEl.style.animation = 'none';
                void countdownEl.offsetWidth; 
                countdownEl.style.animation = null;
            }

            if (countdownEl && staticPartEl) {
                const threshold75 = startCountValue * 0.75;
                const threshold30 = startCountValue * 0.3;

                if (currentCount > threshold75) {
                    countdownEl.style.color = '#00aaff'; 
                    staticPartEl.style.color = '#00aaff';
                } else if (currentCount > threshold30) {
                    countdownEl.style.color = 'white'; 
                    staticPartEl.style.color = 'white';
                } else {
                    countdownEl.style.color = '#ff0055'; 
                    staticPartEl.style.color = '#ff0055';
                }
            }

            if (currentCount <= 0) {
                hideEmojis(); 
                if (btn) btn.textContent = '80% بدء توقع عادي';
                if (btn) btn.disabled = false; 
                if (imageWrapper) imageWrapper.classList.remove('jitter-active');
                
                isRunning = false;
                if (countdownInterval) clearTimeout(countdownInterval);
                if (countdownWrapper) countdownWrapper.classList.remove('visible');
                return;
            }

            countdownInterval = setTimeout(runInterval, COUNTDOWN_INTERVAL); 
        };

        runInterval();
    }

    if (btn) {
      btn.onclick = () => {
        if (!isRunning) {
          startSimpleCountdown();
        }
      };
    }

    resetAll();
}

function navigateBackFromVIP() { history.back(); if (!previousPage) showMainInterface(true); }

function checkInitialConditions() {
    if (document.getElementById('mainInterface').style.display === 'none') return;
    
    if (navigator.onLine) {
        if (!isMusicReady) {
            toggleLoadingScreen(true, "جـاري الـتحـميل"); 
            return false;
        } else {
            toggleLoadingScreen(false);
            return true;
        }
    } else {
        toggleLoadingScreen(false); 
        return false;
    }
}

function showMainInterface(resetSearch = true) {
    const newPage = document.getElementById('newPage');
    if (newPage) newPage.remove();
    document.getElementById('mainInterface').style.display = 'flex';
    document.getElementById('searchWrapper').style.display = 'flex';
    document.getElementById('BannerStripVIP').style.opacity = '1';
    
    if (sidebar && sidebar.classList.contains('open')) toggleSidebar();
    
    applyEffectVisual('rain', currentEffectsState.rain, false);
    applyEffectVisual('stars', currentEffectsState.stars, false);
    applyEffectVisual('neon', currentEffectsState.neon, false);
    updateVisualsVIP();

    if (resetSearch) {
        document.getElementById('searchInput').value = '';
        filterIcons();
    }

    checkOnlineStatus();
    if (isOnline) playMusic();
    checkInitialConditions();

    if (window.location.hash.startsWith('#page') || window.location.hash === '#VIP') {
         history.pushState({ page: 'main' }, 'الواجهة الرئيسية', '#');
    }
}

function openNewPage(iconNumber) {
    pauseMusic();
    
    history.pushState({ page: iconNumber }, `واجهة جديدة رقم ${iconNumber}`, `#page${iconNumber}`);
    
    document.getElementById('mainInterface').style.display = 'none';
    document.getElementById('searchWrapper').style.display = 'none';
    document.getElementById('BannerStripVIP').style.opacity = '0';
    
    if (sidebar && sidebar.classList.contains('open')) toggleSidebar();

    const oldPage = document.getElementById('newPage');
    if (oldPage) oldPage.remove();

    toggleLoadingScreen(true, "جاري الدخول إلى اللعبة...");
    setTimeout(() => {
        toggleLoadingScreen(false);
        document.body.insertAdjacentHTML('beforeend', projectHTMLTemplate(iconNumber));
        executeProjectJS(iconNumber); 
    }, 2000);
}

function handleIconClick(iconNumber) {
    if (iconNumber === 0) {
        openPageVIP();
    } else if (iconNumber >= 1 && iconNumber <= 9) { 
        if (!isOnline) {
             showToast("❌ لا يمكن الدخول: يجب توفر اتصال بالإنترنت.", 3000);
             return;
        }
        
        if (!isMusicReady) {
            playMusic();
            if (!isMusicReady) {
                showToast("❌ لا يمكن الدخول: يجب بدء تشغيل الموسيقى أولاً.", 3000);
                return;
            }
        }
        
        openNewPage(iconNumber);
    } else if (iconNumber >= 10 && iconNumber <= 16) {
        showToast(`هذا التطبيق غير مدعوم حالياً (${iconNumber})`, 3000);
    }
}

function openPageVIP() {
    if (!isOnline) {
        showToast("❌ لا يمكن فتح صفحة VIP: يجب توفر اتصال بالإنترنت.", 3000);
        return;
    }

    const currentPage = history.state;
    if (currentPage && currentPage.page !== 'VIP') {
        if (typeof currentPage.page === 'number') {
            previousPage = { type: 'project', iconNumber: currentPage.page };
        } else if (currentPage.page === 'main' || currentPage.page === 'search' || currentPage.page === undefined) {
            previousPage = { type: 'main' };
        }
    }
    
    history.pushState({ page: 'VIP' }, 'صفحة الاشتراك في VIP', '#VIP');
    document.getElementById('mainInterface').style.display = 'none';
    document.getElementById('searchWrapper').style.display = 'none';
    document.getElementById('BannerStripVIP').style.opacity = '0';
    
    if (sidebar && sidebar.classList.contains('open')) toggleSidebar();
    
    const oldPage = document.getElementById('newPage');
    if (oldPage) oldPage.remove();
    
    document.body.insertAdjacentHTML('beforeend', `
        <div id="newPage" class="VIP-page-container">
            <button class="close-btn" style="position: absolute; top: 20px; right: 20px;" onclick="navigateBackFromVIP()">✖</button>
            <div class="liquid-bg"></div>
            <div class="stars"></div>
            
            <h2 style="position: relative; z-index: 10;">  <span style="color:#ff4500;">VIP</span>الترقية</h2>
            <p style="text-align: center; max-width: 380px; font-size: 15px; color: rgba(255, 255, 255, 0.8); margin-bottom: 40px; position: relative; z-index: 10;">
                <span style="color: #ffd700; font-weight: bold;">ارتقِ بتجربتك!</span> نُسخة VIP توفر لك دقة لا مثيل لها، سرعة فائقة، وميزات حصرية صُممت للمحترفين.
            </p>

            <ul class="feature-list" style="position: relative; z-index: 10;">
                <li><span class="feature-icon">🎯</span><div><strong>100% توقعات بدقة </strong><small>وداعاً للتوقعات الجزئية. الآن، كل توقعاتك دقيقة بشكل مطلق.</small></div></li>
                <li><span class="feature-icon">🧠</span><div><strong>دعم الذكاء الاصطناعي الفائق</strong><small>استفد من تحليل متقدم للبيانات يعطيك الأسبقية دائماً.</small></div></li>
                <li><span class="feature-icon">⏱️</span><div><strong>تجربة مستخدم سريعة وحيوية</strong><small>واجهة انسيابية ومؤثرات بصرية حصرية لراحة عينيك.</small></div></li>
                <li><span class="feature-icon">🔒</span><div><strong>دعم فني فوري ومستمر</strong><small>VIP ضمان حصولك على أقصى استفادة من ميزات .</small></div></li>
            </ul>
            
            <div class="price-table" style="position: relative; z-index: 10;">
                <h3>باقات الاشتراك المتميزة</h3>
                <div class="price-row"><span class="term">اشتراك شهر</span><span class="cost">50 دولار</span></div>
                <div class="price-row best-value"><span class="term">اشتراك 5 شهور</span><span class="cost">100 دولار</span></div>
                <div class="price-row"><span class="term">اشتراك سنة كاملة</span><span class="cost">200 دولار</span></div>
            </div>

            <div class="activation-section" style="position: relative; z-index: 10;">
                <p style="text-align: center; color: #ccc; font-size: 14px; margin-top: 0; margin-bottom: 15px; border-bottom: 1px dashed rgba(255, 255, 255, 0.1); padding-bottom: 10px;">
                    لتفعيل نسختك، أدخل كود التفعيل الذي حصلت عليه:
                </p>
                <label for="CodeInputVIP">كود تفعيل VIP</label>
                <input type="text" id="CodeInputVIP" placeholder="أدخل كود التفعيل هنا..." maxlength="20">
                <button id="activateCodeBtn" class="activate-btn">تفعيل نسخة VIP 🔑</button>
            </div>

            <button id="whatsappBtn" class="whatsapp-btn" style="position: relative; z-index: 10;">
                 <svg class="whatsapp-icon" viewBox="0 0 24 24"><path d="M12.04 2C7.94 2 4.45 4.38 2.37 7.78L2.01 7.23C1.75 6.83 1.25 6.64 0.76 6.81L0 7.08L0.19 7.74L0.2 7.75C0.34 8.24 0.5 8.71 0.69 9.17L0.7 9.2L0.75 9.32C0.97 9.94 1.24 10.55 1.55 11.13L1.57 11.16C1.94 11.85 2.35 12.52 2.8 13.16C3.25 13.79 3.73 14.39 4.25 14.97L4.28 15.01C5.35 16.2 6.6 17.15 8.01 17.85L8.03 17.86L8.08 17.89C8.61 18.15 9.15 18.39 9.71 18.62L9.73 18.63C10.29 18.84 10.86 19.03 11.45 19.18L11.47 19.19L11.51 19.2C11.66 19.24 11.82 19.27 12 19.29L12.04 19.29C16.92 19.29 20.9 15.25 21 10.2L20.89 10.15L20.84 10.12C20.47 9.87 20.07 9.65 19.67 9.47L19.53 9.41C19.14 9.24 18.72 9.14 18.3 9.13L17.9 9.12C17.43 9.12 16.99 9.3 16.64 9.66L15.93 10.37C15.68 10.63 15.35 10.82 15.01 10.92L14.71 11.02C14.36 11.11 14.04 11.08 13.75 10.92L13.74 10.92C13.43 10.74 13.19 10.46 13.06 10.13L12.78 9.44C12.7 9.25 12.69 9.06 12.75 8.87L12.92 8.35C12.96 8.21 12.99 8.07 13 7.93V7.9C13 7.42 12.83 7.02 12.44 6.75L12.44 6.75C12.05 6.47 11.63 6.36 11.21 6.43L11.02 6.47C10.59 6.54 10.19 6.72 9.88 7.02L9.88 7.02C9.57 7.32 9.38 7.72 9.31 8.15L9.27 8.32C9.25 8.4 9.23 8.47 9.23 8.55V8.57C9.23 8.65 9.23 8.74 9.25 8.82L9.42 9.37C9.58 9.77 9.84 10.13 10.18 10.42L10.2 10.44C10.51 10.7 10.86 10.88 11.23 10.97L11.39 11.01C11.5 11.03 11.61 11.04 11.72 11.04C11.83 11.04 11.94 11.03 12.05 11.01L12.19 10.96C12.56 10.86 12.91 10.67 13.19 10.4L13.2 10.39C13.48 10.12 13.68 9.77 13.78 9.41L14.12 8.26C14.15 8.16 14.17 8.06 14.17 7.96V7.94C14.17 7.64 14.07 7.37 13.88 7.14L13.88 7.14C13.69 6.91 13.43 6.75 13.15 6.66L12.96 6.59C12.68 6.51 12.39 6.48 12.11 6.5L12.07 6.5C7.94 6.5 4.54 8.78 2.5 12.12L2.51 12.12C2.7 12.42 3.03 12.58 3.38 12.51L3.58 12.46C3.93 12.39 4.25 12.2 4.49 11.9L4.5 11.89C4.81 11.5 4.96 11.02 4.96 10.51V10.49C4.96 10.25 4.9 10.02 4.79 9.81L4.76 9.75C4.65 9.53 4.49 9.33 4.29 9.15L4.27 9.14C4.05 8.92 3.79 8.73 3.5 8.58L3.48 8.57C3.18 8.42 2.87 8.31 2.55 8.25L2.52 8.24C2.24 8.18 1.95 8.18 1.67 8.25L1.47 8.3C1.18 8.37 0.9 8.5 0.65 8.68L0.64 8.68C0.38 8.87 0.17 9.11 0.02 9.38L0 9.39L0.01 9.4C0 9.41 0 9.41 0 9.42V9.43C0 9.44 0 9.45 0 9.46L0 9.48C0 9.49 0 9.5 0 9.51L0 9.54C0 9.58 0 9.61 0 9.65C0 9.68 0 9.71 0 9.74L0 9.76C0 9.8 0 9.84 0 9.88V19.29L2.83 19.33L2.83 19.33C3.01 19.35 3.2 19.38 3.39 19.41L3.42 19.42C3.65 19.46 3.88 19.5 4.11 19.54L4.2 19.55C4.38 19.58 4.57 19.61 4.76 19.64L4.8 19.64C5.03 19.68 5.27 19.72 5.51 19.75L5.54 19.76C5.81 19.8 6.08 19.84 6.35 19.88L6.4 19.89C6.67 19.93 6.95 19.96 7.23 20L7.27 20C7.57 20.03 7.87 20.06 8.17 20.08L8.2 20.08C8.5 20.11 8.81 20.13 9.11 20.15L9.15 20.15C9.46 20.17 9.77 20.19 10.08 20.2L10.12 20.21C10.43 20.22 10.74 20.23 11.05 20.24L11.08 20.24C11.39 20.25 11.71 20.25 12.04 20.25C17.65 20.25 22.29 15.61 22.29 10C22.29 4.39 17.65 0 12.04 0C6.43 0 1.79 4.39 1.79 10C1.79 10.98 1.93 11.94 2.19 12.86L2.2 12.89C2.42 13.67 2.72 14.41 3.1 15.11L3.11 15.13C3.41 15.68 3.76 16.2 4.14 16.69L4.17 16.73C4.57 17.22 5.01 17.67 5.48 18.09L5.51 18.11C6.01 18.57 6.55 18.99 7.12 19.37L7.17 19.4C7.75 19.76 8.35 20.08 8.98 20.36L9.04 20.39C9.72 20.7 10.44 20.94 11.17 21.13L11.23 21.14C11.59 21.23 11.96 21.28 12.33 21.31L12.37 21.31C13.04 21.35 13.71 21.34 14.39 21.28L14.42 21.28C14.77 21.24 15.12 21.18 15.47 21.11L15.5 21.1C15.86 21.03 16.21 20.95 16.57 20.85L16.62 20.84C16.98 20.73 17.33 20.61 17.69 20.47L17.74 20.45C18.1 20.31 18.45 20.16 18.8 19.99L18.86 19.96C19.22 19.79 19.57 19.61 19.92 19.41L19.98 19.38C20.33 19.18 20.68 18.97 21.02 18.74L21.08 18.7C21.41 18.47 21.75 18.23 22.08 17.97L22.13 17.93C22.45 17.67 22.77 17.4 23.09 17.11L23.14 17.07C23.45 16.78 23.77 16.48 24.08 16.16L24.13 16.11C24.44 15.79 24.74 15.46 25.03 15.11L25.09 15.06C25.37 14.71 25.65 14.35 25.92 13.98L25.98 13.9C26.24 13.52 26.51 13.14 26.75 12.75L26.77 12.72C27.01 12.33 27.24 11.94 27.46 11.53L27.5 11.48C27.69 11.11 27.87 10.74 28.02 10.36L28.06 10.28C28.18 9.97 28.29 9.65 28.38 9.32L28.4 9.27C28.56 8.7 28.67 8.12 28.74 7.53L28.75 7.51C28.84 6.91 28.88 6.3 28.88 5.68C28.88 5.06 28.84 4.45 28.75 3.84L28.74 3.82C28.66 3.22 28.53 2.62 28.35 2.03L28.33 1.97C28.18 1.4 27.97 0.84 27.71 0.3L27.7 0.29C27.5 0.08 27.28 0 27.06 0L12.04 0Z"></path></svg>
                 تواصل معانا لتفعيل الاشتراك 💬
            </button>
        </div>
    `);
    
    document.getElementById('activateCodeBtn').onclick = () => {
        const input = document.getElementById('CodeInputVIP');
        activateVIP(input.value);
        input.value = '';
    };

    document.getElementById('whatsappBtn').onclick = () => {
        const phoneNumber = '01202230265';
        const message = encodeURIComponent("مرحباً، أود الاشتراك في نسخة VIP من تطبيق التوقعات.");
        window.open(`https://wa.me/+20${phoneNumber}?text=${message}`, '_blank');
    };
}

window.onpopstate = function(event) {
    const state = event.state;
    
    if (state === null || state.page === undefined || state.page === 'main' || state.page === 'search') {
        showMainInterface(state?.page !== 'search');
        isSearching = state?.page === 'search';
    } else if (state.page === 'VIP') {
        openPageVIP();
    } else if (typeof state.page === 'number') {
        openNewPage(state.page);
    } else {
        showMainInterface(true);
    }
};

document.addEventListener('click', () => {
    if (document.getElementById('mainInterface').style.display !== 'none' && !backgroundMusic.playing) {
        if (isOnline) playMusic();
    }
});

document.addEventListener('DOMContentLoaded', () => {
    checkStatusVIP();
    checkOnlineStatus();
    loadEffectsState(); 
    
    const bannerInner = document.getElementById('BannerInnerVIP');
    if (bannerInner) {
        const originalBanners = Array.from(bannerInner.children);
        originalBanners.forEach(banner => {
            const clone = banner.cloneNode(true);
            bannerInner.appendChild(clone);
        });
    }
    startBannerSlider();
    
    if (!window.location.hash || window.location.hash === '#search') {
        history.replaceState({ page: 'main' }, 'الواجهة الرئيسية', '#');
    }

    if (window.location.hash) {
        const hash = window.location.hash;
        const iconNumberMatch = hash.match(/#page(\d+)/);
        
        if (hash === '#VIP') {
             document.getElementById('mainInterface').style.display = 'none';
             document.getElementById('searchWrapper').style.display = 'none';
             openPageVIP(); 
        } else if (iconNumberMatch) {
            const iconNumber = parseInt(iconNumberMatch[1]);
            document.getElementById('mainInterface').style.display = 'none';
            document.getElementById('searchWrapper').style.display = 'none';
            
            pauseMusic();
            toggleLoadingScreen(true, "جاري الدخول إلى اللعبة...");
            setTimeout(() => {
                toggleLoadingScreen(false);
                document.body.insertAdjacentHTML('beforeend', projectHTMLTemplate(iconNumber));
                executeProjectJS(iconNumber); 
            }, 2000); 
        } else {
            showMainInterface(true);
        }
    } else {
        showMainInterface(true);
    }

    const link = document.createElement('link');
    link.href = 'https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap';
    link.rel = 'stylesheet';
    document.head.appendChild(link);
    
    startUserCountUpdates();
});
</script>
</body>
</html>
